<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品油站维修管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
<!-- 登录模态框 -->
<div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-8 transform transition-all duration-300 scale-100">
        <div class="text-center mb-6">
            <i class="fas fa-industry text-blue-600 text-4xl mb-4"></i>
            <h2 class="text-2xl font-bold text-gray-900">产品油站维修管理系统</h2>
            <p class="text-gray-500 mt-2">请登录系统</p>
        </div>

        <form id="loginForm" class="space-y-4">
            <div>
                <label for="username" class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-user text-gray-400"></i>
                    </div>
                    <input type="text" id="username" name="username" required
                           class="w-full pl-10 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="输入用户名">
                </div>
            </div>

            <div>
                <label for="password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-lock text-gray-400"></i>
                    </div>
                    <input type="password" id="password" name="password" required
                           class="w-full pl-10 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="输入密码">
                </div>
            </div>

            <div class="text-red-500 text-sm hidden" id="loginError">
                用户名或密码错误，请重试
            </div>

            <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                登录
            </button>
        </form>

        <div class="mt-6 text-center text-sm text-gray-500">
            <p>可用账号：</p>
            <p>管理员: admin / 123456</p>
            <p>访客: guest / 123456</p>
        </div>
    </div>
</div>

<!-- 顶部导航 -->
<nav class="bg-white shadow-sm border-b hidden" id="mainNav">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
            <div class="flex items-center">
                <i class="fas fa-industry text-blue-600 text-2xl mr-3"></i>
                <h1 class="text-xl font-semibold text-gray-900">产品油站维修管理系统</h1>
            </div>
            <div class="flex items-center space-x-4">
                <button id="stationsBtn" class="menu-btn px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md">
                    <i class="fas fa-gas-pump mr-2"></i>油站管理
                </button>
                <button id="productsBtn" class="menu-btn px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-md">
                    <i class="fas fa-cogs mr-2"></i>产品管理
                </button>
                <button id="repairsBtn" class="menu-btn px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-md">
                    <i class="fas fa-wrench mr-2"></i>维修管理
                </button>
                <div class="flex items-center">
                    <span id="currentUser" class="text-sm text-gray-700 mr-3"></span>
                    <button id="logoutBtn" class="text-sm text-gray-500 hover:text-gray-700">
                        <i class="fas fa-sign-out-alt"></i> 退出
                    </button>
                </div>
            </div>
        </div>
    </div>
</nav>

<!-- 主内容区 -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 hidden" id="mainContent">
    <!-- 数据概览 -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow-sm p-6 border transform transition-all hover:shadow-md">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-gas-pump text-blue-600 text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">油站总数</p>
                    <p class="text-2xl font-semibold text-gray-900" id="stationsCount">12</p>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow-sm p-6 border transform transition-all hover:shadow-md">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-cogs text-green-600 text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">产品总数</p>
                    <p class="text-2xl font-semibold text-gray-900" id="productsCount">17</p>
                </div>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow-sm p-6 border transform transition-all hover:shadow-md">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <i class="fas fa-wrench text-red-600 text-2xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">维修订单</p>
                    <p class="text-2xl font-semibold text-gray-900" id="repairsCount">15</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 操作按钮区域 -->
    <div class="flex justify-between mb-6">
        <div>
            <h2 class="text-lg font-semibold text-gray-900" id="currentTitle">油站管理</h2>
        </div>
        <div class="flex space-x-3">
            <label for="excelImport" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 cursor-pointer inline-flex items-center admin-only transition-colors">
                <i class="fas fa-file-excel mr-2"></i>导入Excel
                <input type="file" id="excelImport" accept=".xlsx,.xls" class="hidden">
            </label>
            <button id="excelExport" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 inline-flex items-center admin-only transition-colors">
                <i class="fas fa-download mr-2"></i>导出Excel
            </button>
            <button id="addItemBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 inline-flex items-center admin-only transition-colors">
                <i class="fas fa-plus mr-2"></i>新增
            </button>
        </div>
    </div>

    <!-- 搜索和筛选区域 -->
    <div id="searchFilterArea" class="bg-white rounded-lg shadow-sm p-6 border mb-8">
        <!-- 油站搜索筛选 -->
        <div id="stationsSearch" class="search-section">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="stationIdSearch" class="block text-sm font-medium text-gray-700 mb-1">油站ID</label>
                    <input type="text" id="stationIdSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="输入油站ID">
                </div>
                <div>
                    <label for="stationNameSearch" class="block text-sm font-medium text-gray-700 mb-1">油站名称</label>
                    <input type="text" id="stationNameSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="输入油站名称">
                </div>
                <div>
                    <label for="stationRegionSearch" class="block text-sm font-medium text-gray-700 mb-1">行政区域</label>
                    <input type="text" id="stationRegionSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="输入区域">
                </div>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="searchStationsBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                    <i class="fas fa-search mr-2"></i>搜索
                </button>
                <button id="resetStationsBtn" class="ml-3 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors">
                    <i class="fas fa-redo mr-2"></i>重置
                </button>
            </div>
        </div>

        <!-- 产品搜索筛选 -->
        <div id="productsSearch" class="search-section hidden">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <label for="productIdSearch" class="block text-sm font-medium text-gray-700 mb-1">产品序列号</label>
                    <input type="text" id="productIdSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="输入产品序列号">
                </div>
                <div>
                    <label for="productTypeSearch" class="block text-sm font-medium text-gray-700 mb-1">产品类别</label>
                    <input type="text" id="productTypeSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="输入产品类别">
                </div>
                <div>
                    <label for="productLineSearch" class="block text-sm font-medium text-gray-700 mb-1">产品线</label>
                    <select id="productLineSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">全部</option>
                        <option value="V">V系列</option>
                        <option value="G">G系列</option>
                    </select>
                </div>
                <div>
                    <label for="productStationSearch" class="block text-sm font-medium text-gray-700 mb-1">安装油站</label>
                    <select id="productStationSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">全部油站</option>
                    </select>
                </div>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="searchProductsBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                    <i class="fas fa-search mr-2"></i>搜索
                </button>
                <button id="resetProductsBtn" class="ml-3 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors">
                    <i class="fas fa-redo mr-2"></i>重置
                </button>
            </div>
        </div>

        <!-- 维修搜索筛选 -->
        <div id="repairsSearch" class="search-section hidden">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div>
                    <label for="repairIdSearch" class="block text-sm font-medium text-gray-700 mb-1">维修订单号</label>
                    <input type="text" id="repairIdSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="输入维修订单号">
                </div>
                <div>
                    <label for="repairProductSearch" class="block text-sm font-medium text-gray-700 mb-1">产品序列号</label>
                    <input type="text" id="repairProductSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="输入产品序列号">
                </div>
                <div>
                    <label for="repairStationSearch" class="block text-sm font-medium text-gray-700 mb-1">报修油站</label>
                    <select id="repairStationSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">全部油站</option>
                    </select>
                </div>
                <div>
                    <label for="repairStatusSearch" class="block text-sm font-medium text-gray-700 mb-1">维修进度</label>
                    <select id="repairStatusSearch" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">全部进度</option>
                        <option value="待处理">待处理</option>
                        <option value="维修中">维修中</option>
                        <option value="已完成">已完成</option>
                        <option value="已取消">已取消</option>
                    </select>
                </div>
            </div>
            <div class="mt-4 flex justify-end">
                <button id="searchRepairsBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                    <i class="fas fa-search mr-2"></i>搜索
                </button>
                <button id="resetRepairsBtn" class="ml-3 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors">
                    <i class="fas fa-redo mr-2"></i>重置
                </button>
            </div>
        </div>
    </div>

    <!-- 数据表格区域 -->
    <div class="bg-white rounded-lg shadow-sm border">
        <!-- 油站表格 -->
        <div id="stationsTable" class="table-section">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">油站ID</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">油站名称</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">行政区域</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">油站地址</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">登记时间</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                    </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="stationsTableBody">
                    </tbody>
                </table>
            </div>
            <div class="px-6 py-3 bg-gray-50 border-t flex justify-between items-center">
                <div class="text-sm text-gray-700">显示 <span id="stationsDisplayCount">10</span> 条，共 <span id="stationsTotalCount">12</span> 条</div>
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-700">第 <span id="stationsCurrentPage">1</span> 页 / 共 <span id="stationsTotalPages">2</span> 页</span>
                    <button id="prevStationsBtn" class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="nextStationsBtn" class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 产品表格 -->
        <div id="productsTable" class="table-section hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">产品序列号</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">产品类别</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">产品线</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">安装油站</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">安装日期</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">质保到期日</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                    </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="productsTableBody">
                    </tbody>
                </table>
            </div>
            <div class="px-6 py-3 bg-gray-50 border-t flex justify-between items-center">
                <div class="text-sm text-gray-700">显示 <span id="productsDisplayCount">10</span> 条，共 <span id="productsTotalCount">17</span> 条</div>
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-700">第 <span id="productsCurrentPage">1</span> 页 / 共 <span id="productsTotalPages">2</span> 页</span>
                    <button id="prevProductsBtn" class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="nextProductsBtn" class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- 维修表格 -->
        <div id="repairsTable" class="table-section hidden">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">维修订单号</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">产品序列号</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">产品类别</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">报修油站</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">申请时间</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">故障类别</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">维修进度</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                    </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="repairsTableBody">
                    </tbody>
                </table>
            </div>
            <div class="px-6 py-3 bg-gray-50 border-t flex justify-between items-center">
                <div class="text-sm text-gray-700">显示 <span id="repairsDisplayCount">10</span> 条，共 <span id="repairsTotalCount">15</span> 条</div>
                <div class="flex items-center space-x-2">
                    <span class="text-sm text-gray-700">第 <span id="repairsCurrentPage">1</span> 页 / 共 <span id="repairsTotalPages">2</span> 页</span>
                    <button id="prevRepairsBtn" class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="nextRepairsBtn" class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 详情模态框 -->
<div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden opacity-0 transition-opacity duration-300">
    <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300">
        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
            <h2 id="modalTitle" class="text-xl font-semibold text-gray-900">详情信息</h2>
            <button id="closeModalBtn" class="text-gray-400 hover:text-gray-500 transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div id="modalContent" class="p-6">
            <!-- 详情内容将在这里动态生成 -->
        </div>
    </div>
</div>

<!-- 新增产品弹窗 -->
<div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden opacity-0 transition-opacity duration-300">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300">
        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">新增产品</h2>
            <button id="closeAddProductModal" class="text-gray-400 hover:text-gray-500 transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="p-6">
            <form id="addProductForm">
                <input type="hidden" id="productStationId">

                <div class="mb-4">
                    <label for="newProductSerial" class="block text-sm font-medium text-gray-700 mb-1">产品序列号 <span class="text-red-500">*</span></label>
                    <input type="text" id="newProductSerial" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="输入产品序列号">
                </div>

                <div class="mb-4">
                    <label for="newProductTypeCode" class="block text-sm font-medium text-gray-700 mb-1">产品类别码 <span class="text-red-500">*</span></label>
                    <input type="text" id="newProductTypeCode" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="输入产品类别码">
                </div>

                <div class="mb-4">
                    <label for="newProductTypeDesc" class="block text-sm font-medium text-gray-700 mb-1">类别描述 <span class="text-red-500">*</span></label>
                    <input type="text" id="newProductTypeDesc" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="输入类别描述">
                </div>

                <div class="mb-4">
                    <label for="newProductLine" class="block text-sm font-medium text-gray-700 mb-1">产品线 <span class="text-red-500">*</span></label>
                    <select id="newProductLine" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="V">V系列</option>
                        <option value="G">G系列</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label for="newProductInstallDate" class="block text-sm font-medium text-gray-700 mb-1">安装日期 <span class="text-red-500">*</span></label>
                    <input type="date" id="newProductInstallDate" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div class="mb-4">
                    <label for="newProductWarrantyDate" class="block text-sm font-medium text-gray-700 mb-1">质保到期日 <span class="text-red-500">*</span></label>
                    <input type="date" id="newProductWarrantyDate" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="cancelAddProduct" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
                        取消
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 新增维修弹窗 -->
<div id="addRepairModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden opacity-0 transition-opacity duration-300">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300">
        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">新增维修订单</h2>
            <button id="closeAddRepairModal" class="text-gray-400 hover:text-gray-500 transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="p-6">
            <form id="addRepairForm">
                <input type="hidden" id="repairProductSerial">
                <input type="hidden" id="repairProductType">

                <div class="mb-4">
                    <label for="newRepairId" class="block text-sm font-medium text-gray-700 mb-1">维修订单号 <span class="text-red-500">*</span></label>
                    <input type="text" id="newRepairId" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="输入维修订单号">
                </div>

                <div class="mb-4">
                    <label for="newRepairStation" class="block text-sm font-medium text-gray-700 mb-1">报修油站 <span class="text-red-500">*</span></label>
                    <select id="newRepairStation" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">选择油站</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label for="newRepairDate" class="block text-sm font-medium text-gray-700 mb-1">申请时间 <span class="text-red-500">*</span></label>
                    <input type="date" id="newRepairDate" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div class="mb-4">
                    <label for="newRepairFaultType" class="block text-sm font-medium text-gray-700 mb-1">故障类别 <span class="text-red-500">*</span></label>
                    <select id="newRepairFaultType" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="人为损坏">人为损坏</option>
                        <option value="自然灾害">自然灾害</option>
                        <option value="电气故障">电气故障</option>
                        <option value="软件故障">软件故障</option>
                        <option value="机械故障">机械故障</option>
                    </select>
                </div>

                <div class="mb-4">
                    <label for="newRepairDescription" class="block text-sm font-medium text-gray-700 mb-1">故障描述 <span class="text-red-500">*</span></label>
                    <textarea id="newRepairDescription" rows="3" required
                              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              placeholder="输入故障描述"></textarea>
                </div>

                <div class="mb-4">
                    <label for="newRepairStatus" class="block text-sm font-medium text-gray-700 mb-1">维修进度 <span class="text-red-500">*</span></label>
                    <select id="newRepairStatus" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="待处理">待处理</option>
                        <option value="维修中">维修中</option>
                        <option value="已完成">已完成</option>
                        <option value="已取消">已取消</option>
                    </select>
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="cancelAddRepair" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
                        取消
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 维修状态编辑弹窗 -->
<div id="editRepairModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden opacity-0 transition-opacity duration-300">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300">
        <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
            <h2 class="text-xl font-semibold text-gray-900">修改维修状态</h2>
            <button id="closeEditRepairModal" class="text-gray-400 hover:text-gray-500 transition-colors">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="p-6">
            <form id="editRepairForm">
                <input type="hidden" id="editRepairId">

                <div class="mb-6">
                    <label for="editRepairStatus" class="block text-sm font-medium text-gray-700 mb-1">维修进度 <span class="text-red-500">*</span></label>
                    <select id="editRepairStatus" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="待处理">待处理</option>
                        <option value="维修中">维修中</option>
                        <option value="已完成">已完成</option>
                        <option value="已取消">已取消</option>
                    </select>
                </div>

                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" id="cancelEditRepair" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors">
                        取消
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                        保存
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // 全局变量
    let currentUser = null;
    let currentView = 'stations'; // 默认显示油站管理

    // 测试数据
    const stationsData = [
        { id: 'S001', name: '城东加油站', region: '东城区', address: '东城区东方路123号', registerTime: '2023-01-15' },
        { id: 'S002', name: '城西加油站', region: '西城区', address: '西城区西湖路45号', registerTime: '2023-02-20' },
        { id: 'S003', name: '城南加油站', region: '南城区', address: '南城区南湖路67号', registerTime: '2023-03-10' },
        { id: 'S004', name: '城北加油站', region: '北城区', address: '北城区北京路89号', registerTime: '2023-04-05' },
        { id: 'S005', name: '中心加油站', region: '中心区', address: '中心区中心大道10号', registerTime: '2023-05-18' },
        { id: 'S006', name: '高新区加油站', region: '高新区', address: '高新区科技路22号', registerTime: '2023-06-30' },
        { id: 'S007', name: '工业园区加油站', region: '工业园区', address: '工业园区工业路33号', registerTime: '2023-07-12' },
        { id: 'S008', name: '滨海加油站', region: '滨海区', address: '滨海区海景路44号', registerTime: '2023-08-15' },
        { id: 'S009', name: '山区加油站', region: '山区', address: '山区山路55号', registerTime: '2023-09-20' },
        { id: 'S010', name: '河区加油站', region: '河区', address: '河区河路66号', registerTime: '2023-10-01' },
        { id: 'S011', name: '湖区别墅区加油站', region: '湖区', address: '湖区湖光路77号', registerTime: '2023-11-11' },
        { id: 'S012', name: '森林公园加油站', region: '郊区', address: '郊区公园路88号', registerTime: '2023-12-25' }
    ];

    const productsData = [
        { serial: 'P001', typeCode: 'TC001', typeDesc: '加油机', line: 'V', station: 'S001', installDate: '2023-01-20', warrantyDate: '2026-01-19' },
        { serial: 'P002', typeCode: 'TC001', typeDesc: '加油机', line: 'V', station: 'S001', installDate: '2023-01-20', warrantyDate: '2026-01-19' },
        { serial: 'P003', typeCode: 'TC002', typeDesc: '储油罐', line: 'G', station: 'S001', installDate: '2023-01-18', warrantyDate: '2028-01-17' },
        { serial: 'P004', typeCode: 'TC001', typeDesc: '加油机', line: 'V', station: 'S002', installDate: '2023-02-25', warrantyDate: '2026-02-24' },
        { serial: 'P005', typeCode: 'TC003', typeDesc: '监控系统', line: 'G', station: 'S002', installDate: '2023-02-26', warrantyDate: '2025-02-25' },
        { serial: 'P006', typeCode: 'TC004', typeDesc: '支付终端', line: 'V', station: 'S003', installDate: '2023-03-15', warrantyDate: '2025-03-14' },
        { serial: 'P007', typeCode: 'TC001', typeDesc: '加油机', line: 'G', station: 'S003', installDate: '2023-03-16', warrantyDate: '2026-03-15' },
        { serial: 'P008', typeCode: 'TC005', typeDesc: '消防设备', line: 'V', station: 'S004', installDate: '2023-04-10', warrantyDate: '2027-04-09' },
        { serial: 'P009', typeCode: 'TC001', typeDesc: '加油机', line: 'V', station: 'S004', installDate: '2023-04-08', warrantyDate: '2026-04-07' },
        { serial: 'P010', typeCode: 'TC002', typeDesc: '储油罐', line: 'G', station: 'S005', installDate: '2023-05-22', warrantyDate: '2028-05-21' },
        { serial: 'P011', typeCode: 'TC006', typeDesc: '照明系统', line: 'V', station: 'S005', installDate: '2023-05-23', warrantyDate: '2025-05-22' },
        { serial: 'P012', typeCode: 'TC001', typeDesc: '加油机', line: 'G', station: 'S006', installDate: '2023-07-05', warrantyDate: '2026-07-04' },
        { serial: 'P013', typeCode: 'TC003', typeDesc: '监控系统', line: 'V', station: 'S007', installDate: '2023-07-18', warrantyDate: '2025-07-17' },
        { serial: 'P014', typeCode: 'TC004', typeDesc: '支付终端', line: 'G', station: 'S008', installDate: '2023-08-20', warrantyDate: '2025-08-19' },
        { serial: 'P015', typeCode: 'TC005', typeDesc: '消防设备', line: 'V', station: 'S009', installDate: '2023-09-25', warrantyDate: '2027-09-24' },
        { serial: 'P016', typeCode: 'TC006', typeDesc: '照明系统', line: 'G', station: 'S010', installDate: '2023-10-05', warrantyDate: '2025-10-04' },
        { serial: 'P017', typeCode: 'TC001', typeDesc: '加油机', line: 'V', station: 'S011', installDate: '2023-11-15', warrantyDate: '2026-11-14' }
    ];

    const repairsData = [
        { id: 'R001', productSerial: 'P001', productType: '加油机', station: 'S001', applyTime: '2023-06-10', faultType: '机械故障', status: '已完成' },
        { id: 'R002', productSerial: 'P004', productType: '加油机', station: 'S002', applyTime: '2023-07-15', faultType: '电气故障', status: '已完成' },
        { id: 'R003', productSerial: 'P005', productType: '监控系统', station: 'S002', applyTime: '2023-08-05', faultType: '软件故障', status: '已完成' },
        { id: 'R004', productSerial: 'P006', productType: '支付终端', station: 'S003', applyTime: '2023-09-20', faultType: '软件故障', status: '已完成' },
        { id: 'R005', productSerial: 'P008', productType: '消防设备', station: 'S004', applyTime: '2023-10-10', faultType: '机械故障', status: '已完成' },
        { id: 'R006', productSerial: 'P010', productType: '储油罐', station: 'S005', applyTime: '2023-11-05', faultType: '人为损坏', status: '已完成' },
        { id: 'R007', productSerial: 'P012', productType: '加油机', station: 'S006', applyTime: '2023-12-15', faultType: '机械故障', status: '已完成' },
        { id: 'R008', productSerial: 'P013', productType: '监控系统', station: 'S007', applyTime: '2024-01-20', faultType: '电气故障', status: '已完成' },
        { id: 'R009', productSerial: 'P015', productType: '消防设备', station: 'S009', applyTime: '2024-02-10', faultType: '机械故障', status: '已完成' },
        { id: 'R010', productSerial: 'P002', productType: '加油机', station: 'S001', applyTime: '2024-03-05', faultType: '电气故障', status: '维修中' },
        { id: 'R011', productSerial: 'P007', productType: '加油机', station: 'S003', applyTime: '2024-03-12', faultType: '机械故障', status: '维修中' },
        { id: 'R012', productSerial: 'P009', productType: '加油机', station: 'S004', applyTime: '2024-03-18', faultType: '软件故障', status: '待处理' },
        { id: 'R013', productSerial: 'P011', productType: '照明系统', station: 'S005', applyTime: '2024-03-20', faultType: '电气故障', status: '待处理' },
        { id: 'R014', productSerial: 'P014', productType: '支付终端', station: 'S008', applyTime: '2024-03-22', faultType: '软件故障', status: '待处理' },
        { id: 'R015', productSerial: 'P016', productType: '照明系统', station: 'S010', applyTime: '2024-03-25', faultType: '自然灾害', status: '已取消' }
    ];

    // DOM 加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
        // 初始化登录表单提交事件
        document.getElementById('loginForm').addEventListener('submit', handleLogin);

        // 初始化导航按钮事件
        document.getElementById('stationsBtn').addEventListener('click', () => switchView('stations'));
        document.getElementById('productsBtn').addEventListener('click', () => switchView('products'));
        document.getElementById('repairsBtn').addEventListener('click', () => switchView('repairs'));

        // 初始化登出按钮事件
        document.getElementById('logoutBtn').addEventListener('click', handleLogout);

        // 初始化搜索和重置按钮事件
        document.getElementById('searchStationsBtn').addEventListener('click', searchStations);
        document.getElementById('resetStationsBtn').addEventListener('click', resetStationsSearch);
        document.getElementById('searchProductsBtn').addEventListener('click', searchProducts);
        document.getElementById('resetProductsBtn').addEventListener('click', resetProductsSearch);
        document.getElementById('searchRepairsBtn').addEventListener('click', searchRepairs);
        document.getElementById('resetRepairsBtn').addEventListener('click', resetRepairsSearch);

        // 初始化分页按钮事件
        document.getElementById('prevStationsBtn').addEventListener('click', () => changePage('stations', -1));
        document.getElementById('nextStationsBtn').addEventListener('click', () => changePage('stations', 1));
        document.getElementById('prevProductsBtn').addEventListener('click', () => changePage('products', -1));
        document.getElementById('nextProductsBtn').addEventListener('click', () => changePage('products', 1));
        document.getElementById('prevRepairsBtn').addEventListener('click', () => changePage('repairs', -1));
        document.getElementById('nextRepairsBtn').addEventListener('click', () => changePage('repairs', 1));

        // 初始化模态框关闭按钮事件
        document.getElementById('closeModalBtn').addEventListener('click', closeDetailModal);

        // 初始化新增按钮事件
        document.getElementById('addItemBtn').addEventListener('click', showAddModal);

        // 初始化导出按钮事件
        document.getElementById('excelExport').addEventListener('click', exportToExcel);

        // 填充测试数据到下拉框
        populateStationDropdowns();
    });

    // 处理登录
    function handleLogin(e) {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        // 简单验证
        if ((username === 'admin' && password === '123456') ||
            (username === 'guest' && password === '123456')) {

            currentUser = username;
            document.getElementById('currentUser').textContent = username === 'admin' ? '管理员' : '访客';

            // 隐藏登录模态框，显示主内容
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('mainNav').classList.remove('hidden');
            document.getElementById('mainContent').classList.remove('hidden');

            // 根据用户权限控制功能
            updateUserPermissions();

            // 加载数据
            loadData();
        } else {
            document.getElementById('loginError').classList.remove('hidden');
        }
    }

    // 更新用户权限
    function updateUserPermissions() {
        const isAdmin = currentUser === 'admin';
        const adminElements = document.querySelectorAll('.admin-only');

        // 显示或隐藏管理员专用元素
        adminElements.forEach(el => {
            el.style.display = isAdmin ? 'inline-flex' : 'none';
        });

        // 如果是访客，确保所有编辑按钮被移除或禁用
        if (!isAdmin) {
            const actionButtons = document.querySelectorAll('.action-btn');
            actionButtons.forEach(btn => {
                if (btn.textContent.includes('编辑') || btn.textContent.includes('删除') || btn.textContent.includes('新增')) {
                    btn.remove();
                }
            });
        }
    }

    // 处理登出
    function handleLogout() {
        currentUser = null;
        document.getElementById('loginModal').classList.remove('hidden');
        document.getElementById('mainNav').classList.add('hidden');
        document.getElementById('mainContent').classList.add('hidden');
        document.getElementById('loginForm').reset();
        document.getElementById('loginError').classList.add('hidden');
    }

    // 切换视图
    function switchView(view) {
        currentView = view;

        // 更新标题
        const titles = {
            stations: '油站管理',
            products: '产品管理',
            repairs: '维修管理'
        };
        document.getElementById('currentTitle').textContent = titles[view];

        // 更新导航按钮样式
        document.querySelectorAll('.menu-btn').forEach(btn => {
            btn.classList.remove('bg-blue-600', 'text-white');
            btn.classList.add('text-gray-700', 'hover:bg-gray-100');
        });
        document.getElementById(`${view}Btn`).classList.remove('text-gray-700', 'hover:bg-gray-100');
        document.getElementById(`${view}Btn`).classList.add('bg-blue-600', 'text-white');

        // 显示对应的搜索区域和表格
        document.querySelectorAll('.search-section').forEach(section => {
            section.classList.add('hidden');
        });
        document.getElementById(`${view}Search`).classList.remove('hidden');

        document.querySelectorAll('.table-section').forEach(table => {
            table.classList.add('hidden');
        });
        document.getElementById(`${view}Table`).classList.remove('hidden');

        // 重新加载数据
        loadData();

        // 根据用户权限更新按钮状态
        updateUserPermissions();
    }

    // 加载数据
    function loadData() {
        switch(currentView) {
            case 'stations':
                renderStationsTable(stationsData);
                document.getElementById('stationsCount').textContent = stationsData.length;
                document.getElementById('stationsTotalCount').textContent = stationsData.length;
                break;
            case 'products':
                renderProductsTable(productsData);
                document.getElementById('productsCount').textContent = productsData.length;
                document.getElementById('productsTotalCount').textContent = productsData.length;
                break;
            case 'repairs':
                renderRepairsTable(repairsData);
                document.getElementById('repairsCount').textContent = repairsData.length;
                document.getElementById('repairsTotalCount').textContent = repairsData.length;
                break;
        }
    }

    // 渲染油站表格
    function renderStationsTable(data) {
        const tableBody = document.getElementById('stationsTableBody');
        tableBody.innerHTML = '';

        data.forEach(station => {
            const row = document.createElement('tr');
            row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${station.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${station.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${station.region}</td>
                    <td class="px-6 py-4">${station.address}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${station.registerTime}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button onclick="showStationDetail('${station.id}')" class="text-blue-600 hover:text-blue-900 mr-3 transition-colors">
                            <i class="fas fa-eye"></i> 查看
                        </button>
                        <button onclick="editStation('${station.id}')" class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors admin-only action-btn">
                            <i class="fas fa-edit"></i> 编辑
                        </button>
                        <button onclick="deleteStation('${station.id}')" class="text-red-600 hover:text-red-900 transition-colors admin-only action-btn">
                            <i class="fas fa-trash"></i> 删除
                        </button>
                    </td>
                `;
            tableBody.appendChild(row);
        });
    }

    // 渲染产品表格
    function renderProductsTable(data) {
        const tableBody = document.getElementById('productsTableBody');
        tableBody.innerHTML = '';

        data.forEach(product => {
            // 查找油站名称
            const station = stationsData.find(s => s.id === product.station);
            const stationName = station ? station.name : '';

            row = document.createElement('tr');
            row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${product.serial}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${product.typeDesc} (${product.typeCode})</td>
                    <td class="px-6 py-4 whitespace-nowrap">${product.line}系列</td>
                    <td class="px-6 py-4 whitespace-nowrap">${stationName} (${product.station})</td>
                    <td class="px-6 py-4 whitespace-nowrap">${product.installDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${product.warrantyDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button onclick="showProductDetail('${product.serial}')" class="text-blue-600 hover:text-blue-900 mr-3 transition-colors">
                            <i class="fas fa-eye"></i> 查看
                        </button>
                        <button onclick="editProduct('${product.serial}')" class="text-indigo-600 hover:text-indigo-900 mr-3 transition-colors admin-only action-btn">
                            <i class="fas fa-edit"></i> 编辑
                        </button>
                        <button onclick="deleteProduct('${product.serial}')" class="text-red-600 hover:text-red-900 mr-3 transition-colors admin-only action-btn">
                            <i class="fas fa-trash"></i> 删除
                        </button>
                        <button onclick="addRepairForProduct('${product.serial}', '${product.typeDesc}')" class="text-green-600 hover:text-green-900 transition-colors admin-only action-btn">
                            <i class="fas fa-wrench"></i> 报修
                        </button>
                    </td>
                `;
            tableBody.appendChild(row);
        });
    }

    // 渲染维修表格
    function renderRepairsTable(data) {
        const tableBody = document.getElementById('repairsTableBody');
        tableBody.innerHTML = '';

        data.forEach(repair => {
            // 查找油站名称
            const station = stationsData.find(s => s.id === repair.station);
            const stationName = station ? station.name : '';

            // 设置状态标签样式
            let statusClass = '';
            switch(repair.status) {
                case '待处理':
                    statusClass = 'bg-yellow-100 text-yellow-800';
                    break;
                case '维修中':
                    statusClass = 'bg-blue-100 text-blue-800';
                    break;
                case '已完成':
                    statusClass = 'bg-green-100 text-green-800';
                    break;
                case '已取消':
                    statusClass = 'bg-gray-100 text-gray-800';
                    break;
            }

            const row = document.createElement('tr');
            row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">${repair.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${repair.productSerial}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${repair.productType}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${stationName} (${repair.station})</td>
                    <td class="px-6 py-4 whitespace-nowrap">${repair.applyTime}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${repair.faultType}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                            ${repair.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button onclick="showRepairDetail('${repair.id}')" class="text-blue-600 hover:text-blue-900 mr-3 transition-colors">
                            <i class="fas fa-eye"></i> 查看
                        </button>
                        <button onclick="editRepairStatus('${repair.id}', '${repair.status}')" class="text-indigo-600 hover:text-indigo-900 transition-colors admin-only action-btn">
                            <i class="fas fa-edit"></i> 编辑
                        </button>
                    </td>
                `;
            tableBody.appendChild(row);
        });
    }

    // 填充油站下拉框
    function populateStationDropdowns() {
        const productStationSelect = document.getElementById('productStationSearch');
        const repairStationSelect = document.getElementById('repairStationSearch');
        const newRepairStationSelect = document.getElementById('newRepairStation');

        stationsData.forEach(station => {
            const option1 = document.createElement('option');
            option1.value = station.id;
            option1.textContent = `${station.name} (${station.id})`;
            productStationSelect.appendChild(option1);

            const option2 = document.createElement('option');
            option2.value = station.id;
            option2.textContent = `${station.name} (${station.id})`;
            repairStationSelect.appendChild(option2);

            const option3 = document.createElement('option');
            option3.value = station.id;
            option3.textContent = `${station.name} (${station.id})`;
            newRepairStationSelect.appendChild(option3);
        });
    }

    // 搜索油站
    function searchStations() {
        const id = document.getElementById('stationIdSearch').value.toLowerCase();
        const name = document.getElementById('stationNameSearch').value.toLowerCase();
        const region = document.getElementById('stationRegionSearch').value.toLowerCase();

        const filtered = stationsData.filter(station =>
            (id === '' || station.id.toLowerCase().includes(id)) &&
            (name === '' || station.name.toLowerCase().includes(name)) &&
            (region === '' || station.region.toLowerCase().includes(region))
        );

        renderStationsTable(filtered);
        document.getElementById('stationsTotalCount').textContent = filtered.length;
    }

    // 重置油站搜索
    function resetStationsSearch() {
        document.getElementById('stationIdSearch').value = '';
        document.getElementById('stationNameSearch').value = '';
        document.getElementById('stationRegionSearch').value = '';
        searchStations();
    }

    // 搜索产品
    function searchProducts() {
        const serial = document.getElementById('productIdSearch').value.toLowerCase();
        const type = document.getElementById('productTypeSearch').value.toLowerCase();
        const line = document.getElementById('productLineSearch').value;
        const station = document.getElementById('productStationSearch').value;

        const filtered = productsData.filter(product =>
            (serial === '' || product.serial.toLowerCase().includes(serial)) &&
            (type === '' || product.typeDesc.toLowerCase().includes(type) || product.typeCode.toLowerCase().includes(type)) &&
            (line === '' || product.line === line) &&
            (station === '' || product.station === station)
        );

        renderProductsTable(filtered);
        document.getElementById('productsTotalCount').textContent = filtered.length;
    }

    // 重置产品搜索
    function resetProductsSearch() {
        document.getElementById('productIdSearch').value = '';
        document.getElementById('productTypeSearch').value = '';
        document.getElementById('productLineSearch').value = '';
        document.getElementById('productStationSearch').value = '';
        searchProducts();
    }

    // 搜索维修
    function searchRepairs() {
        const id = document.getElementById('repairIdSearch').value.toLowerCase();
        const product = document.getElementById('repairProductSearch').value.toLowerCase();
        const station = document.getElementById('repairStationSearch').value;
        const status = document.getElementById('repairStatusSearch').value;

        const filtered = repairsData.filter(repair =>
            (id === '' || repair.id.toLowerCase().includes(id)) &&
            (product === '' || repair.productSerial.toLowerCase().includes(product)) &&
            (station === '' || repair.station === station) &&
            (status === '' || repair.status === status)
        );

        renderRepairsTable(filtered);
        document.getElementById('repairsTotalCount').textContent = filtered.length;
    }

    // 重置维修搜索
    function resetRepairsSearch() {
        document.getElementById('repairIdSearch').value = '';
        document.getElementById('repairProductSearch').value = '';
        document.getElementById('repairStationSearch').value = '';
        document.getElementById('repairStatusSearch').value = '';
        searchRepairs();
    }

    // 显示详情模态框
    function showDetailModal(title, content) {
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalContent').innerHTML = content;

        const modal = document.getElementById('detailModal');
        modal.classList.remove('hidden');
        // 触发重排后添加动画类
        setTimeout(() => {
            modal.classList.remove('opacity-0');
            modal.querySelector('div').classList.remove('scale-95');
            modal.querySelector('div').classList.add('scale-100');
        }, 10);
    }

    // 关闭详情模态框
    function closeDetailModal() {
        const modal = document.getElementById('detailModal');
        modal.classList.add('opacity-0');
        modal.querySelector('div').classList.remove('scale-100');
        modal.querySelector('div').classList.add('scale-95');

        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
    }

    // 显示油站详情
    function showStationDetail(stationId) {
        const station = stationsData.find(s => s.id === stationId);
        if (!station) return;

        const content = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">油站基本信息</h3>
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm text-gray-500">油站ID</p>
                                <p class="font-medium">${station.id}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">油站名称</p>
                                <p class="font-medium">${station.name}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">行政区域</p>
                                <p class="font-medium">${station.region}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">油站地址</p>
                                <p class="font-medium">${station.address}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">登记时间</p>
                                <p class="font-medium">${station.registerTime}</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">关联产品</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead>
                                    <tr>
                                        <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">产品序列号</th>
                                        <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">产品类别</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${productsData.filter(p => p.station === stationId).map(product => `
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="px-3 py-2 whitespace-nowrap">${product.serial}</td>
                                            <td class="px-3 py-2 whitespace-nowrap">${product.typeDesc}</td>
                                        </tr>
                                    `).join('') || `
                                        <tr>
                                            <td colspan="2" class="px-3 py-4 text-center text-gray-500">无关联产品</td>
                                        </tr>
                                    `}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;

        showDetailModal(`油站详情 - ${station.name}`, content);
    }

    // 显示产品详情
    function showProductDetail(serial) {
        const product = productsData.find(p => p.serial === serial);
        if (!product) return;

        const station = stationsData.find(s => s.id === product.station);
        const stationName = station ? station.name : '未知油站';

        const content = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">产品基本信息</h3>
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm text-gray-500">产品序列号</p>
                                <p class="font-medium">${product.serial}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">产品类别码</p>
                                <p class="font-medium">${product.typeCode}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">类别描述</p>
                                <p class="font-medium">${product.typeDesc}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">产品线</p>
                                <p class="font-medium">${product.line}系列</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">安装信息</h3>
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm text-gray-500">安装油站</p>
                                <p class="font-medium">${stationName} (${product.station})</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">安装日期</p>
                                <p class="font-medium">${product.installDate}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">质保到期日</p>
                                <p class="font-medium ${new Date(product.warrantyDate) < new Date() ? 'text-red-600' : ''}">
                                    ${product.warrantyDate} ${new Date(product.warrantyDate) < new Date() ? '(已过期)' : ''}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">维修记录</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead>
                                <tr>
                                    <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">维修订单号</th>
                                    <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">申请时间</th>
                                    <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">故障类别</th>
                                    <th class="px-3 py-2 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">维修进度</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${repairsData.filter(r => r.productSerial === serial).map(repair => {
            let statusClass = '';
            switch(repair.status) {
                case '待处理': statusClass = 'bg-yellow-100 text-yellow-800'; break;
                case '维修中': statusClass = 'bg-blue-100 text-blue-800'; break;
                case '已完成': statusClass = 'bg-green-100 text-green-800'; break;
                case '已取消': statusClass = 'bg-gray-100 text-gray-800'; break;
            }
            return `
                                        <tr class="hover:bg-gray-50 transition-colors">
                                            <td class="px-3 py-2 whitespace-nowrap">${repair.id}</td>
                                            <td class="px-3 py-2 whitespace-nowrap">${repair.applyTime}</td>
                                            <td class="px-3 py-2 whitespace-nowrap">${repair.faultType}</td>
                                            <td class="px-3 py-2 whitespace-nowrap">
                                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                                    ${repair.status}
                                                </span>
                                            </td>
                                        </tr>
                                    `;
        }).join('') || `
                                    <tr>
                                        <td colspan="4" class="px-3 py-4 text-center text-gray-500">无维修记录</td>
                                    </tr>
                                `}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

        showDetailModal(`产品详情 - ${product.serial}`, content);
    }

    // 显示维修详情
    function showRepairDetail(repairId) {
        const repair = repairsData.find(r => r.id === repairId);
        if (!repair) return;

        const station = stationsData.find(s => s.id === repair.station);
        const stationName = station ? station.name : '未知油站';

        const product = productsData.find(p => p.serial === repair.productSerial);

        let statusClass = '';
        switch(repair.status) {
            case '待处理': statusClass = 'bg-yellow-100 text-yellow-800'; break;
            case '维修中': statusClass = 'bg-blue-100 text-blue-800'; break;
            case '已完成': statusClass = 'bg-green-100 text-green-800'; break;
            case '已取消': statusClass = 'bg-gray-100 text-gray-800'; break;
        }

        const content = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">维修订单信息</h3>
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm text-gray-500">维修订单号</p>
                                <p class="font-medium">${repair.id}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">申请时间</p>
                                <p class="font-medium">${repair.applyTime}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">故障类别</p>
                                <p class="font-medium">${repair.faultType}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">维修进度</p>
                                <p class="font-medium">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                        ${repair.status}
                                    </span>
                                </p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">关联信息</h3>
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm text-gray-500">产品序列号</p>
                                <p class="font-medium">${repair.productSerial}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">产品类别</p>
                                <p class="font-medium">${repair.productType}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">报修油站</p>
                                <p class="font-medium">${stationName} (${repair.station})</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

        showDetailModal(`维修详情 - ${repair.id}`, content);
    }

    // 显示新增模态框
    function showAddModal() {
        switch(currentView) {
            case 'stations':
                alert('新增油站功能待实现');
                break;
            case 'products':
                document.getElementById('addProductModal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('addProductModal').classList.remove('opacity-0');
                    document.getElementById('addProductModal').querySelector('div').classList.remove('scale-95');
                    document.getElementById('addProductModal').querySelector('div').classList.add('scale-100');
                }, 10);
                break;
            case 'repairs':
                document.getElementById('addRepairModal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('addRepairModal').classList.remove('opacity-0');
                    document.getElementById('addRepairModal').querySelector('div').classList.remove('scale-95');
                    document.getElementById('addRepairModal').querySelector('div').classList.add('scale-100');
                }, 10);
                break;
        }
    }

    // 为产品添加维修记录
    function addRepairForProduct(serial, type) {
        document.getElementById('repairProductSerial').value = serial;
        document.getElementById('repairProductType').value = type;

        // 生成默认维修订单号
        const date = new Date();
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const lastRepair = repairsData[repairsData.length - 1];
        const lastId = lastRepair ? parseInt(lastRepair.id.replace('R', '')) : 0;
        const newId = `R${String(lastId + 1).padStart(3, '0')}`;

        document.getElementById('newRepairId').value = newId;
        document.getElementById('newRepairDate').value = `${year}-${month}-${day}`;

        // 显示弹窗
        document.getElementById('addRepairModal').classList.remove('hidden');
        setTimeout(() => {
            document.getElementById('addRepairModal').classList.remove('opacity-0');
            document.getElementById('addRepairModal').querySelector('div').classList.remove('scale-95');
            document.getElementById('addRepairModal').querySelector('div').classList.add('scale-100');
        }, 10);
    }

    // 编辑维修状态
    function editRepairStatus(repairId, currentStatus) {
        document.getElementById('editRepairId').value = repairId;
        document.getElementById('editRepairStatus').value = currentStatus;

        // 显示弹窗
        document.getElementById('editRepairModal').classList.remove('hidden');
        setTimeout(() => {
            document.getElementById('editRepairModal').classList.remove('opacity-0');
            document.getElementById('editRepairModal').querySelector('div').classList.remove('scale-95');
            document.getElementById('editRepairModal').querySelector('div').classList.add('scale-100');
        }, 10);
    }

    // 改变页码
    function changePage(view, direction) {
        // 简单的分页实现，实际项目中需要根据数据总量计算
        const currentPageEl = document.getElementById(`${view}CurrentPage`);
        const totalPagesEl = document.getElementById(`${view}TotalPages`);
        const prevBtn = document.getElementById(`prev${view.charAt(0).toUpperCase() + view.slice(1)}Btn`);
        const nextBtn = document.getElementById(`next${view.charAt(0).toUpperCase() + view.slice(1)}Btn`);

        let currentPage = parseInt(currentPageEl.textContent);
        const totalPages = parseInt(totalPagesEl.textContent);

        currentPage += direction;

        if (currentPage < 1) currentPage = 1;
        if (currentPage > totalPages) currentPage = totalPages;

        currentPageEl.textContent = currentPage;

        // 禁用/启用分页按钮
        prevBtn.disabled = currentPage === 1;
        nextBtn.disabled = currentPage === totalPages;
    }

    // 导出到Excel
    function exportToExcel() {
        let data, headers, sheetName;

        switch(currentView) {
            case 'stations':
                data = stationsData.map(station => ({
                    '油站ID': station.id,
                    '油站名称': station.name,
                    '行政区域': station.region,
                    '油站地址': station.address,
                    '登记时间': station.registerTime
                }));
                headers = ['油站ID', '油站名称', '行政区域', '油站地址', '登记时间'];
                sheetName = '油站数据';
                break;
            case 'products':
                data = productsData.map(product => {
                    const station = stationsData.find(s => s.id === product.station);
                    return {
                        '产品序列号': product.serial,
                        '产品类别码': product.typeCode,
                        '类别描述': product.typeDesc,
                        '产品线': product.line + '系列',
                        '安装油站ID': product.station,
                        '安装油站名称': station ? station.name : '',
                        '安装日期': product.installDate,
                        '质保到期日': product.warrantyDate
                    };
                });
                headers = ['产品序列号', '产品类别码', '类别描述', '产品线', '安装油站ID', '安装油站名称', '安装日期', '质保到期日'];
                sheetName = '产品数据';
                break;
            case 'repairs':
                data = repairsData.map(repair => {
                    const station = stationsData.find(s => s.id === repair.station);
                    return {
                        '维修订单号': repair.id,
                        '产品序列号': repair.productSerial,
                        '产品类别': repair.productType,
                        '报修油站ID': repair.station,
                        '报修油站名称': station ? station.name : '',
                        '申请时间': repair.applyTime,
                        '故障类别': repair.faultType,
                        '维修进度': repair.status
                    };
                });
                headers = ['维修订单号', '产品序列号', '产品类别', '报修油站ID', '报修油站名称', '申请时间', '故障类别', '维修进度'];
                sheetName = '维修数据';
                break;
            default:
                return;
        }

        // 创建工作簿和工作表
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.json_to_sheet(data, { header: headers });

        // 添加工作表到工作簿
        XLSX.utils.book_append_sheet(wb, ws, sheetName);

        // 生成文件名
        const date = new Date();
        const fileName = `${sheetName}_${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}.xlsx`;

        // 导出文件
        XLSX.writeFile(wb, fileName);
    }

    // 编辑油站
    function editStation(stationId) {
        alert(`编辑油站 ${stationId}（功能待实现）`);
    }

    // 删除油站
    function deleteStation(stationId) {
        if (confirm(`确定要删除油站 ${stationId} 吗？`)) {
            alert(`删除油站 ${stationId}（功能待实现）`);
        }
    }

    // 编辑产品
    function editProduct(serial) {
        alert(`编辑产品 ${serial}（功能待实现）`);
    }

    // 删除产品
    function deleteProduct(serial) {
        if (confirm(`确定要删除产品 ${serial} 吗？`)) {
            alert(`删除产品 ${serial}（功能待实现）`);
        }
    }
</script>
</body>
</html>
